<script src="https://checkout.razorpay.com/v1/checkout.js"></script>

<h1>Complete Your Payment</h1>

<div style="border: 1px solid #ddd; padding: 20px; border-radius: 5px; max-width: 500px; margin: 20px 0; background-color: #f9f9f9;">
  <h2 style="margin-top: 0;">Order Summary</h2>
  <p><strong>Order ID:</strong> #{{ order.id }}</p>
  <p><strong>Total Amount:</strong> <span style="font-size: 24px; color: #2c3e50;">₹{{ order.total_price }}</span></p>
  <p style="color: #7f8c8d; font-size: 14px;">Items: {{ order.items.count }}</p>
</div>

<button id="pay-btn" style="padding: 12px 30px; background-color: #3498db; color: white; border: none; border-radius: 4px; font-size: 16px; cursor: pointer; font-weight: bold;">
  Pay ₹{{ order.total_price }}
</button>

<p style="margin-top: 20px; color: #7f8c8d; font-size: 14px;">
  You will be redirected to Razorpay's secure payment gateway.
</p>

<a href="/orders/checkout/" style="margin-top: 20px; display: inline-block; color: #3498db; text-decoration: none;">
  ← Back to Checkout
</a>

<script>
var options = {
  "key": "{{ razorpay_key }}",
  "amount": "{{ amount }}",
  "currency": "INR",
  "order_id": "{{ razorpay_order_id }}",
  "handler": function(response) {
    // Fill hidden form fields and submit
    document.getElementById('razorpay_payment_id').value = response.razorpay_payment_id;
    document.getElementById('razorpay_signature').value = response.razorpay_signature;
    document.getElementById('paymentForm').submit();
  },
  "prefill": {
    "name": "{{ request.user.get_full_name|default:request.user.username }}",
    "email": "{{ request.user.email }}"
  },
  "theme": {
    "color": "#3498db"
  }
};

var rzp = new Razorpay(options);

document.getElementById("pay-btn").onclick = function(e){
  rzp.open();
  e.preventDefault();
}
</script>

<!-- Hidden form to submit payment data -->
<form id="paymentForm" method="POST" action="{% url 'verify_payment' %}" style="display: none;">
  {% csrf_token %}
  <input type="hidden" id="razorpay_order_id" name="razorpay_order_id" value="{{ razorpay_order_id }}">
  <input type="hidden" id="razorpay_payment_id" name="razorpay_payment_id">
  <input type="hidden" id="razorpay_signature" name="razorpay_signature">
</form>